<%= form_with url: polymorphic_path([:download, content]),
              method: :get,
              local: true do %>

  <fieldset class="active template">
    <legend><%= t('common.choose_language', locale: active_ui_locale) %></legend>
    <div class="form-element">
      <div class="v-select white">
        <%= select_tag('language[]',
                               options_for_select(
                                   available_locales_for_select(content),
                                   I18n.locale
                               ),
                               {
                                   multiple: false,
                                   class: 'multi-select',
                                   id: "language_#{SecureRandom.hex(10)}"
                               }
                    ) %>
      </div>
    </div>
  </fieldset>

  <fieldset class="active serialize_formats">
    <legend><%= t('common.download.available_formats', locale: active_ui_locale) %></legend>
    <div class="form-element">
      <% available_download_serializers(content).each_key.with_index do |serializer_key, i| %>
        <div>
          <%= radio_button_tag "serialize_format", serializer_key, i == 0 %>
          <%= label_tag "serialize_format[#{serializer_key}]", "#{t("common.download.#{serializer_key}", locale: active_ui_locale)}" %>
        </div>
      <% end %>
    </div>
  </fieldset>

  <% if available_download_serializers(content).key?('asset') %>
    <fieldset class="active version hidden">
      <legend><%= t('common.download.available_versions', locale: active_ui_locale) %></legend>
      <div class="form-element">
        <% ([:original] + Array(content.asset&.versions&.keys)).each_with_index do |version, i| %>
          <div>
            <%= radio_button_tag "version", version, i == 0 %>
            <%= label_tag "version[#{version}]", "#{t("common.download.version.#{version}", locale: active_ui_locale)}" %>
          </div>
        <% end %>

      </div>
    </fieldset>

    <% DataCycleCore::Feature::Serialize.asset_versions(content)&.each do |key, value| %>
      <fieldset class="active transformation hidden <%= key %>">
        <legend><%= t('common.download.available_transformations', locale: active_ui_locale) %></legend>
        <div class="form-element">

          <% (['none'] + Array(value)).each_with_index do |t_format, i| %>
            <div>
              <%= radio_button_tag "transformation[#{key}][format]", t_format, i == 0 %>
              <%= label_tag "transformation[#{key}][format][#{t_format}]", "#{t("common.download.format.#{t_format}", default: t_format, locale: active_ui_locale)}" %>
            </div>
          <% end %>

        </div>
      </fieldset>
    <% end %>
  <% end %>

  <div class="buttons">
    <%= button_tag 'download',
                       type: :submit,
                       class: "button submit" %>
  </div>

<% end %>
